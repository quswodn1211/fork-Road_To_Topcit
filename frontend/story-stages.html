<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TOPCIT Quest - ìŠ¤í…Œì´ì§€ ì„ íƒ</title>
  <style>
    
    /* ========================================
       í—¤ë” (main.html ìŠ¤íƒ€ì¼)
       ======================================== */
    header {
      display: flex;
      align-items: center;
      padding: 10px 50px;
      background: white;
    }

    header a, header a:visited {
      margin: 0 15px;
      text-decoration: none;
      color: #333; 
      font-size: 17px;
    }
    
    .user-links a, .user-links a:visited {
      color: #777;
      font-size: 15px;
    }

    nav {
      margin-left: auto;
      margin-right: auto;
    }
    
    @media (max-width: 900px) {
      header {
        flex-wrap: wrap; 
        padding: 10px 20px; 
      }

      .logo-img {
        width: 100%; 
        text-align: center; 
        margin-bottom: 10px;
      }

      nav {
        width: 100%; 
        text-align: center;
        margin: 10px 0; 
      }

      header a {
        display: inline-block;
        margin: 5px 10px;
      }

      .user-links {
        width: 100%; 
        text-align: center;
      }
    }
/* ========================================
       ë©”ì¸ ì»¨í…Œì´ë„ˆ
       ======================================== */
    .main-container {
      flex: 1;
      max-width: 100%;
      margin: 0;
      padding: 0.5rem;
      display: flex;
      flex-direction: column;
    }

    /* ========================================
       ìŠ¤í…Œì´ì§€ í”„ë ˆì„
       ======================================== */
    .stage-frame {
      flex: 1;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      padding: 1.5rem;
      margin-bottom: 0;
      display: flex;
      flex-direction: column;
    }

    .world-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .world-title {
      font-size: 1.8rem;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 0.3rem;
    }

    .world-subtitle {
      color: #6b7280;
      font-size: 1rem;
    }

    /* ========================================
       ê²Œì„ ë§µ ìŠ¤íƒ€ì¼ (ì‹¤ì œ RPG ë§µ)
       ======================================== */
    .game-map-container {
      flex: 1;
      position: relative;
      background: #1a1a1a;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: inset 0 4px 20px rgba(0, 0, 0, 0.5);
      min-height: 500px;
    }

    /* ë§µ ë°°ê²½ ì´ë¯¸ì§€ */
    .map-background {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* ê²½ë¡œ ì˜¤ë²„ë ˆì´ (SVG) */
    .path-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }

    .route-path {
      fill: none;
      stroke: #ff4757;
      stroke-width: 6;
      stroke-dasharray: 15, 10;
      stroke-linecap: round;
      opacity: 0.8;
      animation: dash 30s linear infinite;
    }

    .route-path.cleared {
      stroke: #ffd93d;
      stroke-width: 8;
      animation: dash 30s linear infinite, glow-pulse 2s ease-in-out infinite;
      filter: drop-shadow(0 0 10px #ffd93d);
    }

    @keyframes dash {
      to {
        stroke-dashoffset: -1000;
      }
    }

    @keyframes glow-pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    /* ìŠ¤í…Œì´ì§€ ë…¸ë“œ (ë§µ ìœ„ì— ë°°ì¹˜) */
    .stage-marker {
      position: absolute;
      z-index: 10;
      cursor: pointer;
      transform: translate(-50%, -50%);
      transition: all 0.3s ease;
    }

    .stage-marker:hover {
      transform: translate(-50%, -50%) scale(1.15);
    }

    .stage-marker.locked:hover {
      transform: translate(-50%, -50%);
    }

    /* ìŠ¤í…Œì´ì§€ ë²„íŠ¼ */
    .stage-button {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 4px solid #fff;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      transition: all 0.3s;
    }

    .stage-button:hover {
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
      transform: translateY(-3px);
    }

    .stage-button.locked {
      background: linear-gradient(135deg, #636e72, #2d3436);
      opacity: 0.7;
      cursor: not-allowed;
    }

    .stage-button.locked:hover {
      transform: none;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .stage-button.cleared {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      animation: success-pulse 2s ease-in-out infinite;
    }

    @keyframes success-pulse {
      0%, 100% { box-shadow: 0 8px 25px rgba(67, 233, 123, 0.4); }
      50% { box-shadow: 0 12px 35px rgba(67, 233, 123, 0.7); }
    }

    .stage-icon {
      font-size: 2.5rem;
      margin-bottom: 0.2rem;
    }

    .stage-number {
      font-size: 0.8rem;
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* ìŠ¤í…Œì´ì§€ ë¼ë²¨ */
    .stage-label {
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 0.4rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      white-space: nowrap;
      pointer-events: none;
    }

    /* ì‹œì‘ ì§€ì  ë§ˆì»¤ */
    .start-marker {
      position: absolute;
      z-index: 8;
      transform: translate(-50%, -50%);
    }

    .start-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #ffd93d, #f9ca24);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      box-shadow: 0 8px 20px rgba(249, 202, 36, 0.5);
      border: 4px solid white;
      animation: start-pulse 2s ease-in-out infinite;
    }

    @keyframes start-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* ë‹¤ìŒ ì›”ë“œ ê²Œì´íŠ¸ */
    .next-world-gate {
      position: absolute;
      z-index: 8;
      transform: translate(-50%, -50%);
    }

    .gate-button {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #f093fb, #f5576c);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(240, 147, 251, 0.5);
      border: 5px solid white;
      transition: all 0.3s;
      text-decoration: none;
      color: white;
      font-weight: bold;
      text-align: center;
    }

    .gate-button:hover {
      transform: scale(1.1);
      box-shadow: 0 15px 40px rgba(240, 147, 251, 0.7);
    }

    .gate-button.locked {
      opacity: 0.5;
      cursor: not-allowed;
      background: linear-gradient(135deg, #95a5a6, #7f8c8d);
    }

    .gate-button.locked:hover {
      transform: none;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .gate-icon {
      font-size: 3rem;
    }

    .gate-text {
      font-size: 0.75rem;
      margin-top: 0.2rem;
    }

    /* ========================================
       ë°˜ì‘í˜•
       ======================================== */
    @media (max-width: 768px) {
      .stage-button {
        width: 60px;
        height: 60px;
      }

      .stage-icon {
        font-size: 2rem;
      }

      .start-icon {
        width: 45px;
        height: 45px;
        font-size: 2rem;
      }

      .gate-button {
        width: 75px;
        height: 75px;
      }

      .gate-icon {
        font-size: 2.5rem;
      }
    }
  </style>
</head>
<body>

  <header>
        <div class="logo-img">
          <img src="images/logo.png" alt="ë¡œê³ " style="height:50px; cursor: pointer;" onclick="window.location.href = 'main.html';"> 
        </div>
        <nav>
            <a href="challenge.html">ìŠ¤í‚¬ ì±Œë¦°ì§€</a>
            <a href="guide.html">ì„±ì¥ ê°€ì´ë“œ</a>
            <a href="story.html">ìŠ¤í† ë¦¬ ëª¨ë“œ</a>
        </nav>
        <div class="user-links">
            <a href="login.html">ë¡œê·¸ì¸</a>
            <a href="signup.html">íšŒì›ê°€ì…</a>
        </div>
    </header>

  <!-- ë³¸ë¬¸ -->
  <main class="main-container">
    <div class="stage-frame">
      <div class="world-header">
        <h1 class="world-title" id="world-title">ì›”ë“œ 1 - ê¸°ìˆ  ê²½ì˜ ì´í•´</h1>
        <p class="world-subtitle" id="world-subtitle">ë§µì„ íƒí—˜í•˜ë©° ìŠ¤í…Œì´ì§€ì— ë„ì „í•˜ì„¸ìš”!</p>
      </div>

      <!-- ê²Œì„ ë§µ -->
      <div class="game-map-container">
        <!-- ë°°ê²½ ì´ë¯¸ì§€ -->
        <img src="world-map-sample.png" class="map-background" id="map-background" alt="World Map">
        
        <!-- ê²½ë¡œ ì˜¤ë²„ë ˆì´ (SVG) -->
        <svg class="path-overlay" viewBox="0 0 1000 700" preserveAspectRatio="none">
          <!-- ê²½ë¡œì„ : ì‹œì‘ â†’ ìŠ¤í…Œì´ì§€1 â†’ ìŠ¤í…Œì´ì§€2 â†’ ìŠ¤í…Œì´ì§€3 â†’ ë‹¤ìŒì›”ë“œ(ì„± ì™¼ìª½) -->
          <path id="route-path" class="route-path" 
                d="M 80,650 L 240,640 L 510,640 L 800,485 L 880,130" />
        </svg>

        <!-- ì‹œì‘ ì§€ì  (ì™¼ìª½ í•˜ë‹¨ - ìºë¦­í„° ìœ„ì¹˜) -->
        <div class="start-marker" style="left: 8%; bottom: 8%;">
          <div class="start-icon">ğŸ‘¤</div>
        </div>

        <!-- ìŠ¤í…Œì´ì§€ 1 (ì¤‘ì•™ í•˜ë‹¨ - ì²« ë²ˆì§¸ íŒŒë€ ë™ê·¸ë¼ë¯¸) -->
        <div class="stage-marker" id="stage-1" data-stage="1" 
             style="left: 24%; bottom: 11%;">
          <div class="stage-button">
            <div class="stage-icon">âš”ï¸</div>
            <div class="stage-number">Stage 1</div>
          </div>
          <div class="stage-label">ìŠ¤í…Œì´ì§€ 1</div>
        </div>

        <!-- ìŠ¤í…Œì´ì§€ 2 (ì¤‘ì•™ í•˜ë‹¨ - ë‘ ë²ˆì§¸ íŒŒë€ ë™ê·¸ë¼ë¯¸) -->
        <div class="stage-marker locked" id="stage-2" data-stage="2" 
             style="left: 51%; bottom: 11%;">
          <div class="stage-button locked">
            <div class="stage-icon">ğŸ”’</div>
            <div class="stage-number">Stage 2</div>
          </div>
          <div class="stage-label">ìŠ¤í…Œì´ì§€ 2</div>
        </div>

        <!-- ìŠ¤í…Œì´ì§€ 3 (ì˜¤ë¥¸ìª½ í•˜ë‹¨ - ì„¸ ë²ˆì§¸ íŒŒë€ ë™ê·¸ë¼ë¯¸ ë°”ë¡œ ìœ„) -->
        <div class="stage-marker locked" id="stage-3" data-stage="3" 
             style="left: 80%; bottom: 35%;">
          <div class="stage-button locked">
            <div class="stage-icon">ğŸ”’</div>
            <div class="stage-number">Stage 3</div>
          </div>
          <div class="stage-label">ìŠ¤í…Œì´ì§€ 3</div>
        </div>

        <!-- ë‹¤ìŒ ì›”ë“œ ê²Œì´íŠ¸ (ì„± ë°”ë¡œ ì™¼ìª½) -->
        <div class="next-world-gate" style="right: 5%; top: 16%;">
          <a href="#" class="gate-button locked" id="next-world-gate">
            <div class="gate-icon">ğŸ°</div>
            <div class="gate-text">ë‹¤ìŒ<br>ì›”ë“œ</div>
          </a>
        </div>
      </div>
    </div>
  </main>

  <script>
    // URLì—ì„œ ì›”ë“œ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const currentWorld = parseInt(urlParams.get('world')) || 1;

    // ì›”ë“œ ì •ë³´
    const worldInfo = {
      1: { name: 'ê¸°ìˆ  ê²½ì˜ ì´í•´', icon: 'ğŸ’»' },
      2: { name: 'ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ', icon: 'ğŸ’¾' },
      3: { name: 'ë°ì´í„°ë² ì´ìŠ¤', icon: 'ğŸ—„ï¸' },
      4: { name: 'ë„¤íŠ¸ì›Œí¬', icon: 'ğŸŒ' },
      5: { name: 'ì •ë³´ë³´ì•ˆ', icon: 'ğŸ”' },
      6: { name: 'IT í”„ë¡œì íŠ¸ ê´€ë¦¬', icon: 'ğŸ“Š' }
    };

    // ì›”ë“œ ì œëª© ì„¤ì •
    const worldData = worldInfo[currentWorld];
    document.getElementById('world-title').textContent = 
      `${worldData.icon} ì›”ë“œ ${currentWorld} - ${worldData.name}`;

    // ì§„í–‰ ìƒí™© ë¶ˆëŸ¬ì˜¤ê¸°
    function loadProgress() {
      const saved = localStorage.getItem('storyProgress');
      if (saved) return JSON.parse(saved);
      return {
        worlds: {
          1: { unlocked: true, stagesCleared: 0, stages: { 1: false, 2: false, 3: false } },
          2: { unlocked: false, stagesCleared: 0, stages: { 1: false, 2: false, 3: false } },
          3: { unlocked: false, stagesCleared: 0, stages: { 1: false, 2: false, 3: false } },
          4: { unlocked: false, stagesCleared: 0, stages: { 1: false, 2: false, 3: false } },
          5: { unlocked: false, stagesCleared: 0, stages: { 1: false, 2: false, 3: false } },
          6: { unlocked: false, stagesCleared: 0, stages: { 1: false, 2: false, 3: false } }
        }
      };
    }

    const progress = loadProgress();
    const currentWorldData = progress.worlds[currentWorld];

    // ìŠ¤í…Œì´ì§€ ìƒíƒœ ì ìš©
    for (let i = 1; i <= 3; i++) {
      const stageMarker = document.getElementById(`stage-${i}`);
      const stageButton = stageMarker.querySelector('.stage-button');
      const stageIcon = stageMarker.querySelector('.stage-icon');
      
      // ìŠ¤í…Œì´ì§€ í•´ê¸ˆ ìƒíƒœ í™•ì¸
      const isUnlocked = i === 1 || currentWorldData.stages[i - 1];
      
      if (isUnlocked) {
        stageMarker.classList.remove('locked');
        stageButton.classList.remove('locked');
        stageIcon.textContent = ['âš”ï¸', 'ğŸ—¡ï¸', 'ğŸ†'][i - 1];
      }

      // í´ë¦¬ì–´ ìƒíƒœ
      if (currentWorldData.stages[i]) {
        stageButton.classList.add('cleared');
        stageIcon.textContent = 'âœ…';
      }
    }

    // ê²½ë¡œì„  ì• ë‹ˆë©”ì´ì…˜ (í´ë¦¬ì–´í•œ êµ¬ê°„ë§Œ ë¹›ë‚˜ê²Œ)
    const routePath = document.getElementById('route-path');
    if (currentWorldData.stagesCleared > 0) {
      routePath.classList.add('cleared');
    }

    // ë‹¤ìŒ ì›”ë“œ ê²Œì´íŠ¸ í™œì„±í™”
    const nextWorldGate = document.getElementById('next-world-gate');
    if (currentWorldData.stagesCleared === 3) {
      nextWorldGate.classList.remove('locked');
      if (currentWorld < 6) {
        nextWorldGate.href = `story-stages.html?world=${currentWorld + 1}`;
      } else {
        nextWorldGate.href = `story-mode.html`;
        nextWorldGate.querySelector('.gate-text').innerHTML = 'ì™„ë£Œ!<br>ğŸ‰';
      }
    }

    // ìŠ¤í…Œì´ì§€ í´ë¦­ ì´ë²¤íŠ¸
    document.querySelectorAll('.stage-marker').forEach(marker => {
      marker.addEventListener('click', () => {
        const stageNum = marker.dataset.stage;
        const isLocked = marker.classList.contains('locked');

        if (isLocked) {
          alert('ì´ì „ ìŠ¤í…Œì´ì§€ë¥¼ ë¨¼ì € í´ë¦¬ì–´í•˜ì„¸ìš”! ğŸ”’');
          return;
        }

        // í´ë¦­ ì• ë‹ˆë©”ì´ì…˜
        marker.style.transform = 'translate(-50%, -50%) scale(0.9)';
        setTimeout(() => {
          marker.style.transform = 'translate(-50%, -50%)';
        }, 100);

        // ë¬¸ì œ í’€ì´ í™”ë©´ìœ¼ë¡œ ì´ë™
        setTimeout(() => {
          window.location.href = `problem-solving.html?mode=story&world=${currentWorld}&stage=${stageNum}`;
        }, 200);
      });
    });
  </script>
</body>
</html>